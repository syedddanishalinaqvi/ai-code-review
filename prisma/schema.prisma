
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url=env("DB_URL")
}

model User {
  id        String  @id @default(cuid())
  email     String  @unique
  githubId  String? @unique
  avatarUrl String?
  name      String?

  // Each user has only one GitHub installation
  installation Installation?
  reviews      Review[]
}

model Installation {
  id             Int    @id @default(autoincrement()) // Prisma internal ID
  installationId Int    @unique // GitHub installation ID
  accountLogin   String
  accountType    String // user/org
  userId         String @unique // One installation per user
  user           User   @relation(fields: [userId], references: [id])
  repositories Repository[]
  createdAt DateTime @default(now())
}

model Repository {
  id       Int    @id @default(autoincrement())
  repoId   Int    @unique
  name     String
  fullName String @unique
  installationId Int
  installation Installation @relation(fields:[installationId],references: [installationId], onDelete: Cascade)
  pullRequests PullRequest[]

  createdAt DateTime @default(now())
}

model PullRequest {
  id           Int        @id @default(autoincrement())
  number       Int
  title        String
  state        String
  authorLogin  String
  repositoryId Int
  repository   Repository @relation(fields: [repositoryId], references: [id])

  reviews   Review[]
  createdAt DateTime @default(now())
}

model Review {
  id          Int         @id @default(autoincrement())
  content     String
  pullId      Int
  userId      String
  user        User        @relation(fields: [userId], references: [id])
  pullRequest PullRequest @relation(fields: [pullId], references: [id])
  createdAt   DateTime    @default(now())
}
